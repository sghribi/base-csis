{% extends 'CSISEamBundle::layout.html.twig' %}
{% import 'CSISEamBundle:Eam:pagination.html.twig' as pagination %}

{% block csis_body %}

<div class="row">
  <div class="span12">
    {% include 'CSISEamBundle:Eam:flash.html.twig' %}
    {% include 'CSISEamBundle:Eam:mainflash.html.twig' %}
  </div>
</div>

<div class="row">
  <div class="span12">
    <div class="well"> 
      <h4 class="span11">Liste des Contacts
        <div class="pull-right">       
          <a class="btn btn-success" href="{{ path('people_new') }}" data-toggle="tooltip" title="Créer un nouveau Contact">
            <i class="icon-plus icon-white"></i>
            Ajouter
          </a>
        </div>
      </h4>

      <table class="table table-striped table-hover" style="max-height:400px;overflow:auto">
        <thead>
          <tr style='text-align: center;'>
            <th>Nom</th>
            <th>e-mail</th>
            <th>n° Tel.</th>
            <th>Compte utilisateur</th>
            <th colspan="3">Actions</th>
          </tr>
        </thead>
        <tbody>  
        {# Affiche tous les contacts par ordre alphabétique #}
        {% for people in peoples %}
          <tr>
            <td>{{ people.name }} {{ people.firstname }}</td> {# Nom du contact #}
            <td>{{ people.email }}</td> {# email du contact #}
            <td>{{ people.phoneNumber }}</td> {# téléphone du contact #}
            <td style='text-align: center;'>
                {% if people.useraccount is null %}
                  {% if is_granted("ROLE_GEST_PEOPLE") %}
                    <a href="{{ path('people_create_useraccount', { 'id': people.id }) }}" class="icon-arrow-up" data-toggle="tooltip" title="Créer un compte pour le contact"></a>
                  {% else%}
                    <i class="icon-ban-circle" data-toggle="tooltip" title="Aucun compte utilisateur associé"/>
                  {% endif %}
                {% else %}
                  {% if is_granted("ROLE_GEST_PEOPLE") %}
                    <a href="{{ path('csis_user_show', { 'username': people.useraccount.username }) }}" data-toggle="tooltip" title="Accéder à la fiche utilisateur">{{ people.useraccount.username }}</a>
                  {% else%}
                    {{ people.useraccount.username }}
                  {% endif %}
                {% endif %}
            </td> {# login du compte user associé #}
            <td><a href="{{ path('people_show', { 'id': people.id }) }}" class="icon-eye-open"  title="Afficher" ></a></td> {# Afficher #}
          {% if is_granted("ROLE_GEST_PEOPLE") %}
            <td><a href="{{ path('people_edit', { 'id': people.id }) }}" class="icon-edit" data-toggle="tooltip" title="Modifier" ></a></td> {# Modifier #}
            <td>
              {% if people.useraccount is null %}
                <a href="{{ path('people_ask_delete', { 'id': people.id }) }}" class="icon-trash" data-toggle="tooltip" title="Supprimer le contact" ></a>
              {% else %}
                <a href="{{ path('people_ask_delete', { 'id': people.id }) }}" class="icon-trash" data-toggle="tooltip" title="Supprimer l'utilisateur et le contact" ></a>
              {% endif %}
            </td> {# Supprimer #}
          {% endif %}
          </tr>
        {% else %}
          <tr>
            <td colspan="5">
              <strong>Il n'y a aucun contact à afficher pour la page {{ page }} !</strong><br />
              <a href="{{ path('people') }}">Retour</a>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>

    {{ pagination.pagination('people', page, nbPages) }}

  </div>
</div>
{% endblock %}
